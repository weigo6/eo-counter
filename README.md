# ğŸ“Š EO-Counter åŸºäº EdgeOne Pages å®ç°ç«™ç‚¹è®¿é—®ç»Ÿè®¡åŠŸèƒ½

EO-Counter æ˜¯ä¸€ä¸ªåŸºäº **è…¾è®¯äº‘ EdgeOne Pages æä¾›çš„è¾¹ç¼˜å‡½æ•°ä¸KVå­˜å‚¨åŠŸèƒ½** æ„å»ºçš„è½»é‡çº§ã€è‡ªæ‰˜ç®¡çš„åšå®¢è®¿é—®é‡ç»Ÿè®¡ä¸ç®¡ç†å¹³å°ã€‚

> **ç®€æ´** Â· **å®‰å…¨** Â· **å…è´¹** Â· **æ˜“äºé›†æˆ**

## ğŸŒŸ åŠŸèƒ½äº®ç‚¹

- **å®æ—¶å…¨ç«™ PV ç»Ÿè®¡**ï¼šè‡ªåŠ¨è®°å½•ç«™ç‚¹å„é¡µé¢ï¼ˆURLè·¯å¾„ï¼‰çš„è®¿é—®æ¬¡æ•°ï¼ŒåŒæ—¶ç»´æŠ¤ `site_total_pv` å…¨å±€è®¡æ•°ã€‚

- **å¯è§†åŒ–æ•°æ®çœ‹æ¿**ï¼šæä¾›ä¸€ä¸ª**ç›‘æ§å¤§å±**æ¸…æ™°å±•ç¤ºæ€»è®¿é—®é‡ã€æ”¶å½•é¡µé¢æ•°ã€å½“å‰é¡µæœ€çƒ­é—¨å†…å®¹ã€‚

- **åˆ†é¡µé«˜æ•ˆåŠ è½½**ï¼šé‡‡ç”¨æ¸¸æ ‡åˆ†é¡µï¼ˆCursor-based Paginationï¼‰ï¼Œæµè§ˆä½“éªŒæµç•…ã€‚

- **é«˜é€Ÿåå°æ‰«æ**ï¼šåå°é™é»˜ç»Ÿè®¡å…¨ç«™é¡µé¢æ€»æ•°ï¼Œä¸å½±å“å‰å°äº¤äº’ã€‚

- **å…¨æ–‡è·¯å¾„æœç´¢**ï¼šæ”¯æŒå…³é”®è¯æ¨¡ç³Šæœç´¢ï¼Œå¿«é€Ÿå®šä½ç›®æ ‡é¡µé¢ã€‚

- **åœ¨çº¿æ•°æ®ä¿®æ­£**ï¼šå¯ç›´æ¥åœ¨æ•°æ®çœ‹æ¿ä¸­ä¿®æ”¹æˆ–åˆ é™¤ PV æ•°æ®ã€‚

  > å¦‚æœåˆ é™¤å­é¡µé¢çš„ç»Ÿè®¡æ•°æ®ï¼Œ`site_total_pv` å…¨å±€è®¡æ•°æ•°å€¼ä¹Ÿä¼šåŒæ­¥æ‰£å‡ã€‚è€Œä¿®æ”¹ï¼ˆæ›´æ–°ï¼‰å­é¡µé¢ PV æ—¶ **ä¸ä¼š** åŒæ­¥è°ƒæ•´å…¨å±€ PVã€‚
  >
  > **ä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡ï¼Ÿ**
  >
  > - **åˆ é™¤æ“ä½œ**æ˜¯â€œç§»é™¤ä¸€æ¡ç‹¬ç«‹è®°å½•â€ï¼Œé€»è¾‘ä¸Šåº”ä»æ€»æ•°ä¸­å‰”é™¤ã€‚
  > - **`site_total_pv` çš„è®¾è®¡æœ¬æ„æ˜¯â€œå…¨ç«™çœŸå®ç´¯è®¡è®¿é—®æ¬¡æ•°â€**ï¼Œè€Œéâ€œæ‰€æœ‰å­é¡µé¢ PV çš„å½“å‰å€¼ä¹‹å’Œâ€ã€‚
  > - å¦‚æœä¿®æ”¹ï¼ˆæ›´æ–°ï¼‰å­é¡µé¢ PV æ—¶æƒ³åŒæ­¥è°ƒæ•´å…¨å±€ PVï¼Œè¯·æ‰‹åŠ¨ä¿®æ­£å…¨å±€ PV æ•°æ®ã€‚

- **å“åº”å¼è®¾è®¡ä¸ä¸»é¢˜åˆ‡æ¢**ï¼šå®Œç¾é€‚é…æ¡Œé¢ä¸ç§»åŠ¨è®¾å¤‡ï¼Œæ”¯æŒäº®è‰²/æš—è‰²ä¸»é¢˜ä¸€é”®åˆ‡æ¢ï¼Œä¿æŠ¤åŒçœ¼ã€‚

> [!NOTE]
>
> **PVï¼ˆPage Viewï¼‰**ï¼Œä¸­æ–‡é€šå¸¸è¯‘ä¸ºâ€œ**é¡µé¢æµè§ˆé‡**â€æˆ–â€œ**é¡µé¢è®¿é—®æ¬¡æ•°**â€ï¼Œæ˜¯ Web ç½‘ç«™æµé‡åˆ†æä¸­æœ€åŸºç¡€ã€æœ€é‡è¦çš„æŒ‡æ ‡ä¹‹ä¸€ã€‚**PV = ç”¨æˆ·æ¯æ¬¡æˆåŠŸåŠ è½½ä¸€ä¸ªç½‘é¡µï¼Œå³è®¡ä¸º 1 æ¬¡ PVã€‚**åŒä¸€ç”¨æˆ·çš„åˆ·æ–°æ“ä½œä¼šæ›´æ–°PVè®¡æ•°å€¼ã€‚

## ğŸ› ï¸å¿«é€Ÿä¸Šæ‰‹

æœ¬é¡¹ç›®æ ¹æ®è…¾è®¯äº‘ EdgeOne Pages å¹³å°ç‰¹æ€§è®¾è®¡ï¼Œæä¾›ç®€åŒ–çš„éƒ¨ç½²æ–¹æ¡ˆã€‚

> ç”±äºPages KVå­˜å‚¨è¦æ±‚KEYå€¼åªèƒ½ä¸ºæ•°å­—ã€å­—æ¯ã€å†’å·`:`åŠä¸‹åˆ’çº¿ï¼Œæ‰€ä»¥ç«™ç‚¹å„é¡µé¢ï¼ˆURLè·¯å¾„ï¼‰ä¼šè¢«ç¼–ç åå­˜å‚¨ã€‚
>
> åœ¨å¯è§†åŒ–ç›‘æ§å¤§å±ä¸­ï¼Œå¯ä»¥çœ‹åˆ°è¢«è¿˜åŸçš„ URL è·¯å¾„ï¼Œå¹¶æ”¯æŒæ•°æ®ä¿®æ”¹æ“ä½œã€‚
>
> ç¼–ç æ–¹å¼åœ¨æœ¬æ–‡URLè·¯å¾„ç¼–ç èŠ‚ä¸­å™è¿°ã€‚

### Edgeone éƒ¨ç½²æ“ä½œ

1. æ³¨å†Œè…¾è®¯äº‘è´¦å·å¹¶å¼€é€š EdgeOne æœåŠ¡ï¼Œç™»å½• [EdgeOne Pages æ§åˆ¶å°](https://console.cloud.tencent.com/edgeone/pages)

2. åˆ›å»º Edgeone Pages é¡¹ç›®

      - ç™»å½•è…¾è®¯äº‘ EdgeOne æ§åˆ¶å°
      - åˆ›å»ºæ–°çš„ Pages é¡¹ç›®
      - é€‰æ‹© GitHub ä½œä¸ºä»£ç æº
      - å…³è”ï¼ˆforkï¼‰æœ¬ä»“åº“ã€‚æˆ–è€…ç›´æ¥ä¸‹è½½æœ¬ä»“åº“ï¼Œæ‰‹åŠ¨ä¸Šä¼ åˆ° EdgeOne Pages é‡Œï¼ˆä¼šè‡ªåŠ¨è§¦å‘éƒ¨ç½²ï¼‰ã€‚
      - > æ„å»ºè®¾ç½®ä¿æŒé»˜è®¤å³å¯ã€‚

   ![image-20260102144626973](README.assets/image-20260102144626973.png)

3. é…ç½® KV å­˜å‚¨
   - åœ¨ EdgeOne Pages æ§åˆ¶å°åˆ›å»º KV å‘½åç©ºé—´
   - å°† KV å‘½åç©ºé—´ç»‘å®šåˆ°é¡¹ç›®ï¼Œå˜é‡åè®¾ä¸ºï¼š`BLOG_DB` ï¼ˆæ­¤å˜é‡åè¢«ç¨‹åºè°ƒç”¨ï¼Œå¿…é¡»ä¿æŒå®Œå…¨ç›¸åŒï¼‰
     ![image-20260102145100813](README.assets/image-20260102145100813.png)

4. è®¾ç½®ç¯å¢ƒå˜é‡

   - ç¯å¢ƒå˜é‡å¿…é¡»é…ç½®âœ…

   - | ç¯å¢ƒå˜é‡å       | è¯´æ˜                                                         |
     | ---------------- | ------------------------------------------------------------ |
     | `DASHBOARD_PWD`  | ç®¡ç†å‘˜æ§åˆ¶å°ç™»å½•å¯†é’¥ã€‚ç”¨äº `api/admin.js` çš„èº«ä»½éªŒè¯ï¼ˆ`X-Auth-Token`ï¼‰ã€‚ |
     | `ALLOWED_ORIGIN` | å…è®¸è®¿é—® API çš„å‰ç«¯åŸŸåï¼ˆç”¨äº CORSï¼‰ã€‚ä¾‹å¦‚ï¼šhttps://your-blog.comã€‚å»ºè®®å¡«å†™ä½ çš„åšå®¢ä¸»ç«™åŸŸåã€‚è®¾ç½®å˜é‡å€¼ä¸ºâ€œ*â€æ—¶æ”¯æŒå…¨éƒ¨åŸŸåçš„è·¨åŸŸè®¿é—®ï¼Œå¯èƒ½ä¼šå¯¼è‡´APIè¢«ç›—åˆ·ã€‚æœ¬åœ°æµ‹è¯•æ—¶å»ºè®®è®¾ç½®ä¸º`*`ï¼Œæ–¹ä¾¿éªŒè¯ã€‚ |
   - ALLOWED_ORIGIN æ ¼å¼ï¼šhttps://example.com,https://blog.example.comï¼ˆå¤šä¸ªåŸŸåç”¨é€—å·åˆ†éš”ï¼Œè¯·å‹¿é—æ¼`https://`ï¼‰
   - ALLOWED_ORIGIN ç¤ºä¾‹åœºæ™¯å¦‚ä¸‹ï¼š
      - åœºæ™¯ 1ï¼šä»…ç”Ÿäº§ç¯å¢ƒ
          ALLOWED_ORIGIN = https://yourblog.com,https://www.yourblog.com
      - åœºæ™¯ 2ï¼šç”Ÿäº§ç¯å¢ƒ + æœ¬åœ°å¼€å‘
          ALLOWED_ORIGIN = https://yourblog.com,http://localhost:3000
      - åœºæ™¯ 3ï¼šå®Œå…¨å¼€æ”¾ (ä»…æµ‹è¯•ç”¨)
          ALLOWED_ORIGIN = *
   - ![image-20260102145951845](README.assets/image-20260102145951845.png)
   - > æ³¨æ„ï¼šç¼–è¾‘ç¯å¢ƒå˜é‡åï¼Œè¦ä½¿å…¶ç”Ÿæ•ˆéœ€è¦åœ¨`æ„å»ºéƒ¨ç½²`ä¸­é‡æ–°éƒ¨ç½²é¡¹ç›®ã€‚

5. ç»‘å®šè‡ªå®šä¹‰åŸŸåï¼Œç”±äº EdgeOne pages åªæä¾›ä¸´æ—¶æµ‹è¯•åŸŸåï¼Œæ‰€ä»¥éœ€è¦ç»‘å®šè‡ªå®šä¹‰åŸŸåï¼Œå¹¶é…ç½®SSLè¯ä¹¦ï¼Œå¼€å¯`https`è®¿é—®ã€‚

6. éƒ¨ç½²å®Œæˆåï¼Œä½ çš„ EdgeOne Pages åœ°å€å³ä¸ºå¯è§†åŒ–ç›‘æ§å¤§å±çš„è®¿é—®åœ°å€ã€‚

   ![image-20260102150438572](README.assets/image-20260102150438572.png)![image-20260102150607998](README.assets/image-20260102150607998.png)
   
   > TOP1 çƒ­é—¨å†…å®¹å®é™…å±•ç¤ºçš„æ˜¯å½“å‰åˆ†é¡µä¸­çƒ­åº¦æœ€é«˜çš„å†…å®¹ã€‚å‡ºäºè¯·æ±‚é‡åŠåŠ è½½é€Ÿåº¦è€ƒè™‘ï¼Œå½“å‰ç‰ˆæœ¬ä»£ç ä¸ä¼šå»è·å– KV å­˜å‚¨ä¸­çš„å…¨éƒ¨ URL è·¯å¾„è®¿é—®é‡ï¼Œè€Œæ˜¯æ ¹æ®éœ€è¦è¯»å–å½“å‰åˆ—è¡¨ä¸­çš„è®¿é—®é‡æ•°æ®ã€‚

### å‰ç«¯åŸ‹ç‚¹ä¸è®¿é—®é‡å±•ç¤ºæŒ‡å—

> [!IMPORTANT]
>
> å‡è®¾ä½ çš„ EdgeOne Pages é¡¹ç›®çš„è®¿é—®åœ°å€ä¸ºï¼šhttps://your-eocount.comï¼Œåˆ™ä½ éœ€è¦åœ¨å‰ç«¯ `js` ä»£ç ä¸­è®¾ç½®çš„ `URL API` åœ°å€ä¸ºï¼šhttps://your-eocount.com/api/visitï¼Œä¸‹æ–‡ä»¥æ­¤åŸŸåä¸¾ä¾‹ã€‚

å‡è®¾ä½ çš„ç»Ÿè®¡æœåŠ¡éƒ¨ç½²åœ°å€ä¸ºï¼š

```
https://your-eocount.com
```

åˆ™å¯¹åº”çš„ç»Ÿè®¡ API åœ°å€ä¸ºï¼š

```
https://your-eocount.com/api/visit
```

è¯¥ API æ”¯æŒ CORSï¼Œä¼šæ ¹æ®ä¼ å…¥çš„ `url` å‚æ•°è‡ªåŠ¨è®°å½•å¹¶è¿”å›ï¼š
- **å…¨ç«™æ€»è®¿é—®é‡ï¼ˆ`total`ï¼‰**
- **å½“å‰é¡µé¢è®¿é—®é‡ï¼ˆ`page`ï¼‰**

#### ä¸€ã€å‰ç«¯åŸ‹ç‚¹

##### 1. é€šç”¨åŸ‹ç‚¹æ–¹å¼ï¼ˆé€‚ç”¨äºé™æ€åšå®¢ï¼‰

###### æ­¥éª¤è¯´æ˜

1. **è·å–å½“å‰é¡µé¢è·¯å¾„**  
   ä½¿ç”¨ `window.location.pathname` è·å–ä¸å¸¦åŸŸåå’ŒæŸ¥è¯¢å‚æ•°çš„è·¯å¾„ã€‚

   ```js
   const currentPath = window.location.pathname;
   // ç¤ºä¾‹ï¼šhttps://example.com/posts/hello â†’ "/posts/hello"
   ```

2. **æ„é€ è¯·æ±‚ URL**  
   å°†è·¯å¾„ä½œä¸º `url` å‚æ•°ä¼ ç»™ç»Ÿè®¡ APIï¼š

   ```js
   const apiUrl = `https://your-eocount.com/api/visit?url=${encodeURIComponent(currentPath)}`;
   ```

   > âš ï¸ **åŠ¡å¿…ä½¿ç”¨ `encodeURIComponent`** å¤„ç†è·¯å¾„ä¸­å¯èƒ½åŒ…å«çš„ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ `/`, `-`, ä¸­æ–‡ç­‰ï¼‰ã€‚

3. **å‘é€åŸ‹ç‚¹è¯·æ±‚**

   ```js
   function trackPageView() {
     const path = window.location.pathname;
     const url = `https://your-eocount.com/api/visit?url=${encodeURIComponent(path)}`;

     fetch(url, { method: 'GET' })
       .then(res => {
         if (res.ok) console.log('âœ… PV tracked');
       })
       .catch(err => {
         console.warn('âš ï¸ Failed to track PV:', err);
       });
   }
   ```

4. **åœ¨é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ**

   ```html
   <script>
     document.addEventListener('DOMContentLoaded', trackPageView);
   </script>
   ```

   æˆ–ç›´æ¥åœ¨ `<body>` åº•éƒ¨ï¼š

   ```html
   <script>trackPageView();</script>
   ```

##### 2. å•é¡µåº”ç”¨ï¼ˆSPAï¼‰ä¸“ç”¨ï¼šç›‘å¬è·¯ç”±å˜åŒ–

###### Vue Routerï¼ˆVue 2/3ï¼‰

```js
// main.js æˆ– router.js
router.afterEach((to) => {
  const url = `https://your-eocount.com/api/visit?url=${encodeURIComponent(to.path)}`;
  fetch(url).catch(() => {});
});
```

###### React Routerï¼ˆv5/v6ï¼‰

```jsx
import { useEffect } from 'react';
import { useLocation } from 'react-router-dom';

function usePageTracking() {
  const location = useLocation();

  useEffect(() => {
    const url = `https://your-eocount.com/api/visit?url=${encodeURIComponent(location.pathname)}`;
    fetch(url).catch(() => {});
  }, [location.pathname]);
}

// åœ¨ App ç»„ä»¶ä¸­è°ƒç”¨
function App() {
  usePageTracking();
  return <Routes>{/* ... */}</Routes>;
}
```

##### 3. æ³¨æ„äº‹é¡¹

| é¡¹ç›®             | è¯´æ˜                                                         |
| ---------------- | ------------------------------------------------------------ |
| **CORS é…ç½®**    | åç«¯éœ€é…ç½® `ALLOWED_ORIGIN` ä¸ºä½ çš„ç«™ç‚¹åŸŸåï¼ˆå¦‚ `https://yourblog.com`ï¼‰ã€‚å¼€å‘æ—¶å¯ä¸´æ—¶è®¾ä¸º `*`ã€‚ |
| **é¿å…é‡å¤åŸ‹ç‚¹** | SPA ä¸­ä»…åœ¨è·¯ç”±åˆ‡æ¢åè§¦å‘ä¸€æ¬¡ï¼›é™æ€é¡µé¢æ— éœ€é¢å¤–å¤„ç†ã€‚         |
| **æ€§èƒ½å½±å“**     | `fetch` ä¸ºå¼‚æ­¥éé˜»å¡è¯·æ±‚ï¼Œä¸å½±å“é¡µé¢åŠ è½½ã€‚                   |
| **HTTPS è¦æ±‚**   | ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ HTTPSï¼Œå¦åˆ™æµè§ˆå™¨å¯èƒ½æ‹¦æˆªè¯·æ±‚ã€‚             |

#### äºŒã€å±•ç¤ºè®¿é—®é‡æ•°æ®

##### 1. åŸºæœ¬æ€è·¯

API æˆåŠŸå“åº”åè¿”å› JSONï¼š

```json
{
  "total": 12345,
  "page": 678
}
```

- `total`ï¼šå…¨ç«™æ€»è®¿é—®é‡ï¼ˆ`site_total_pv`ï¼‰
- `page`ï¼šå½“å‰é¡µé¢è®¿é—®é‡ï¼ˆåŸºäºç¼–ç åçš„ URL keyï¼‰

å‰ç«¯éœ€ï¼š
1. å‘é€è¯·æ±‚ï¼ˆåŒæ—¶å®ŒæˆåŸ‹ç‚¹ï¼‰
2. è§£æè¿”å›æ•°æ®
3. æ›´æ–° DOM

##### 2. é™æ€ç«™ç‚¹å®ç°ç¤ºä¾‹

###### HTML å ä½

```html
<div id="pv-stats" style="font-size: 0.9em; color: #666;">
  æ­£åœ¨åŠ è½½è®¿é—®æ•°æ®...
</div>
```

###### JavaScript æ¸²æŸ“

```html
<script>
  async function displayPageViews() {
    const path = window.location.pathname;
    const apiUrl = `https://your-eocount.com/api/visit?url=${encodeURIComponent(path)}`;

    try {
      const response = await fetch(apiUrl);
      if (!response.ok) throw new Error('Network response was not ok');

      const { total, page } = await response.json();
      const format = (n) => new Intl.NumberFormat().format(n);

      document.getElementById('pv-stats').innerHTML = 
        `æœ¬ç«™æ€»è®¿é—®é‡ï¼š<strong>${format(total)}</strong> æ¬¡<br>
         æœ¬æ–‡é˜…è¯»é‡ï¼š<strong>${format(page)}</strong> æ¬¡`;
    } catch (err) {
      console.warn('âš ï¸ æ— æ³•åŠ è½½è®¿é—®é‡æ•°æ®:', err);
      document.getElementById('pv-stats').innerHTML = 'è®¿é—®é‡ç»Ÿè®¡æš‚æ—¶ä¸å¯ç”¨';
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', displayPageViews);
  } else {
    displayPageViews();
  }
</script>
```

> âœ… **ç‰¹ç‚¹**ï¼š
> - è‡ªåŠ¨åƒä½åˆ†éš”ï¼ˆå¦‚ `12,345`ï¼‰
> - é”™è¯¯é™çº§å‹å¥½
> - ä¸åŸ‹ç‚¹ä¸€ä½“åŒ–ï¼ˆæ¯æ¬¡è®¿é—®éƒ½è®¡æ•°å¹¶å±•ç¤ºæœ€æ–°å€¼ï¼‰

##### 3. SPA ä¸­å±•ç¤ºï¼ˆä»¥ React ä¸ºä¾‹ï¼‰

```jsx
import { useEffect, useState } from 'react';
import { useLocation } from 'react-router-dom';

function PVStats() {
  const [stats, setStats] = useState({ total: 0, page: 0 });
  const [loading, setLoading] = useState(true);
  const location = useLocation();

  useEffect(() => {
    const loadPV = async () => {
      setLoading(true);
      try {
        const res = await fetch(`https://your-eocount.com/api/visit?url=${encodeURIComponent(location.pathname)}`);
        const data = await res.json();
        setStats(data);
      } catch (err) {
        console.warn(err);
      } finally {
        setLoading(false);
      }
    };
    loadPV();
  }, [location.pathname]);

  if (loading) return <div>åŠ è½½ä¸­...</div>;

  return (
    <div>
      å…¨ç«™è®¿é—®ï¼š<strong>{stats.total.toLocaleString()}</strong> æ¬¡<br />
      æœ¬é¡µè®¿é—®ï¼š<strong>{stats.page.toLocaleString()}</strong> æ¬¡
    </div>
  );
}
```

> Vue ç”¨æˆ·å¯å‚è€ƒç±»ä¼¼é€»è¾‘ï¼Œç»“åˆ `onMounted` å’Œ `watch(route.path, ...)` å®ç°ã€‚

#### ä¸‰ã€å®Œæ•´éƒ¨ç½²å»ºè®®

- **åµŒå…¥ä½ç½®**ï¼šå°†è„šæœ¬æ”¾å…¥åšå®¢æ¨¡æ¿çš„ `footer` æˆ– `layout` æ–‡ä»¶ä¸­ï¼Œç¡®ä¿å…¨ç«™ç”Ÿæ•ˆã€‚
- **è°ƒè¯•æ–¹æ³•**ï¼šæ‰“å¼€æµè§ˆå™¨ DevTools â†’ Network â†’ æŸ¥çœ‹ `https://your-eocount.com/api/visit` è¯·æ±‚åŠè¿”å›æ•°æ®ã€‚
- **åŸŸåæ›¿æ¢**ï¼šè¯·å°†æ‰€æœ‰ç¤ºä¾‹ä¸­çš„ `https://your-eocount.com` æ›¿æ¢ä¸ºä½ å®é™…çš„ EdgeOne Pages ç»Ÿè®¡æœåŠ¡åœ°å€ã€‚

#### å››ã€æ•ˆæœé¢„è§ˆ

> **æœ¬ç«™æ€»è®¿é—®é‡ï¼š12,345 æ¬¡**  
> **æœ¬æ–‡é˜…è¯»é‡ï¼š678 æ¬¡**

âœ… é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œä½ çš„ç«™ç‚¹å°†å…·å¤‡**è‡ªåŠ¨åŸ‹ç‚¹ + å®æ—¶å±•ç¤ºè®¿é—®é‡**çš„èƒ½åŠ›ï¼Œæ— éœ€é¢å¤–æ•°æ®åº“æˆ–ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œè½»é‡ã€å®‰å…¨ã€å¯æ§ã€‚


### Mkdocs/Zensical ç«™ç‚¹å¼•å…¥EO-Counter

å…³äºæœ¬èŠ‚å†…å®¹è¯·å‚è€ƒæˆ‘çš„[ä¸ªäººåšå®¢](https://sufine.top)ã€‚

å¦‚æœä½ çš„ç«™ç‚¹é‡‡ç”¨ `Mkdocs-material / Zensical` æ¶æ„ï¼Œè¯·æ–°å»ºä¸€ä¸ª `count.js` æ–‡ä»¶ï¼Œåœ¨`mkdocs.yml`ã€`zensical.toml` ä¸­é…ç½®å¼•å…¥è¯¥ `js` æ–‡ä»¶ã€‚

```js
// ç½‘ç«™è®¡æ•°å™¨ï¼ŒPVç»Ÿè®¡
(function() {
  // === Edge one Pages API åœ°å€ğŸ“===
  const WORKER_URL = "https://your-blog.com/api/visit";

  function fetchStats() {
    // å¦‚æœæ˜¯æœ¬åœ°é¢„è§ˆ (localhost)ï¼Œä¸å‘é€è¯·æ±‚ï¼Œé¿å…æ±¡æŸ“æ•°æ®
    //if (window.location.hostname === "localhost") {
    //  return;
    //}
    // è·å–æ˜¾ç¤ºæ•°å­—çš„å…ƒç´ 
    const siteElem = document.getElementById("site_pv");
    const pageElem = document.getElementById("page_pv");

    // å¦‚æœé¡µé¢ä¸Šæ‰¾ä¸åˆ°è¿™ä¸¤ä¸ªå…ƒç´ ï¼ˆæ¯”å¦‚è¿˜æ²¡åŠ è½½å®Œï¼‰ï¼Œå°±ä¸æ‰§è¡Œ
    if (!siteElem || !pageElem) return;

    // è·å–å½“å‰è·¯å¾„
    const currentPath = window.location.pathname;

    // å‘é€è¯·æ±‚
    fetch(`${WORKER_URL}/?url=${encodeURIComponent(currentPath)}`)
      .then(response => response.json())
      .then(data => {
        // æ›´æ–°é¡µé¢æ•°å­—
        siteElem.innerText = data.total;
        pageElem.innerText = data.page;
      })
      .catch(err => {
        console.error("è®¿é—®ç»Ÿè®¡å‡ºé”™:", err);
        // å‡ºé”™æ—¶å¯ä»¥æ˜¾ç¤º "--" æˆ–è€…éšè—
        siteElem.innerText = "--";
        pageElem.innerText = "--";
      });
  }

  // === å…³é”®é€»è¾‘ï¼šå¤„ç† MkDocs Material/Zensical çš„åŠ è½½æœºåˆ¶ ===
  
  // æ£€æŸ¥æ˜¯å¦æ”¯æŒ Instant Loading (MkDocs Material ç‰¹æ€§)
  if (typeof document$ !== "undefined") {
    // å¦‚æœå¼€å¯äº† Instant Loadingï¼ŒRxJS çš„ document$ ä¼šè´Ÿè´£ç›‘å¬æ‰€æœ‰è·³è½¬ï¼ˆåŒ…æ‹¬é¦–æ¬¡åŠ è½½ï¼‰
    document$.subscribe(function() {
      // è¿™é‡Œçš„ setTimeout æ˜¯å¿…é¡»çš„ï¼Œç­‰å¾…é¡µé¢ DOM æ›¿æ¢å®Œæˆ
      setTimeout(fetchStats, 100);
    });
  } else {
    // å¦‚æœæ²¡æœ‰å¼€å¯ Instant Loadingï¼Œåˆ™å›é€€åˆ°æ ‡å‡†çš„ DOMContentLoaded
    document.addEventListener("DOMContentLoaded", fetchStats);
  }
})();
```

åœ¨ç«™ç‚¹åˆé€‚çš„æ–‡ä»¶å†…ï¼Œæ·»åŠ ä»¥ä¸‹`html`ä»£ç ï¼š

```html
<!-- Site Visits -->
	<style>
    .site-visit-count {
     	padding: 0 12px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 0.65rem;
        color: var(--md-default-fg-color);
    }
    </style>
    <div class="site-visit-count">
      æœ¬ç«™è®¿é—®é‡ï¼š<span id="site_pv">--</span>&nbsp;| å½“å‰é¡µæµè§ˆé‡ï¼š<span id="page_pv">--</span>
    </div>
```

## ğŸ“Œ æŠ€æœ¯æ¶æ„

| ç»„ä»¶ | æŠ€æœ¯ |
|------|------|
| **å‰ç«¯** | Vue 3 + åŸç”Ÿ CSSï¼ˆæ— æ¡†æ¶ï¼‰ |
| **åç«¯ API** | EdgeOne Pages æä¾›çš„ edge-functions è¾¹ç¼˜äº‘å‡½æ•°åŠŸèƒ½ |
| **å­˜å‚¨** | Pages KVï¼ˆKey-Valueï¼‰æ•°æ®åº“ï¼ˆé€šè¿‡ `BLOG_DB` ç»‘å®šï¼‰ |
| **éƒ¨ç½²** | è…¾è®¯äº‘ EdgeOne Pagesï¼ˆé™æ€èµ„æºï¼‰ + Edge Functionï¼ˆAPIï¼‰ |

## ğŸ“ é¡¹ç›®ç»“æ„

```bash
eo-counter/
â”œâ”€â”€ index.html                 # ä¸»æ§åˆ¶å°é¡µé¢(å¯è§†åŒ–ç›‘æ§å¤§å±)
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ admin.js               # åå°ç®¡ç† APIï¼ˆåˆ—è¡¨ã€æ›´æ–°ã€åˆ é™¤ï¼‰
â”‚   â””â”€â”€ visit.js               # è®¿é—®ç»Ÿè®¡ APIï¼ˆæ¥æ”¶å‰ç«¯åŸ‹ç‚¹ï¼‰
â””â”€â”€ README.md
```

## ğŸ” å®‰å…¨æœºåˆ¶

- **ç®¡ç†å‘˜é‰´æƒ**ï¼šæ‰€æœ‰ `api/admin.js` æ¥å£éœ€æºå¸¦ `X-Auth-Token` è¯·æ±‚å¤´ï¼Œå€¼ä¸º `DASHBOARD_PWD` ç¯å¢ƒå˜é‡ã€‚
- **CORS æ§åˆ¶**ï¼šé€šè¿‡ `ALLOWED_ORIGIN` é™åˆ¶å‰ç«¯åŸŸåæ¥æºï¼Œé˜²æ­¢æ•°æ®è¢«ç›—åˆ·ã€‚
- **åªè¯»åˆ†ç¦»**ï¼š`visit.js` ä»…æ¥å— GET è¯·æ±‚ï¼Œæ— æƒé™ä¿®æ”¹æ•°æ®ï¼›`admin.js` éœ€è®¤è¯æ‰èƒ½å†™å…¥ã€‚

## ğŸ”„ URLè·¯å¾„ç¼–ç 

KV ä¸­å­˜å‚¨çš„æ•°æ®æ ¼å¼å¦‚ä¸‹ï¼š

| Keyï¼ˆç¤ºä¾‹ï¼‰ | Valueï¼ˆç¤ºä¾‹ï¼‰ | è¯´æ˜ |
|------------|--------------|------|
| `site_total_pv` | `12580` | å…¨ç«™æ€»è®¿é—®é‡ï¼ˆç³»ç»Ÿä¿ç•™ï¼‰ |
| `_posts_my-article` | `328` | æ˜æ–‡è·¯å¾„ï¼š`/posts/my-article` |
| `_B64:5L2g5aW9...` | `105` | Base64 ç¼–ç è·¯å¾„ï¼ˆå«ä¸­æ–‡ã€ç‰¹æ®Šå­—ç¬¦ç­‰ï¼‰ |

> ğŸ” è·¯å¾„ç¼–ç è§„åˆ™ï¼š
> - è·¯å¾„åˆ†éš”ç¬¦`/`è¢«ç¼–ç ä¸ºä¸‹åˆ’çº¿`_`ï¼Œå¹¶æŒ‰ç…§è·¯å¾„åˆ†éš”ç¬¦è¿›è¡Œåˆ†æ®µã€‚
> - ä»…å«å­—æ¯æ•°å­—çš„æ®µä¿æŒæ˜æ–‡ï¼ˆå¦‚ `about` â†’ `about`ï¼‰ã€‚
> - å«ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ä¸­æ–‡ã€ç©ºæ ¼ã€`-` ç­‰ï¼‰çš„æ®µä½¿ç”¨ Base64 ç¼–ç å¹¶å‰ç¼€ `B64:`ã€‚

## ğŸ“ ç‰ˆæœ¬ä¿¡æ¯

- **å½“å‰ç‰ˆæœ¬**ï¼šv1.0.0 æ­£å¼ç‰ˆ
- **éƒ¨ç½²ç¯å¢ƒ**ï¼šè…¾è®¯äº‘ EdgeOne Pages
- **å¼€æºåè®®**ï¼šMIT
> Made with â¤ï¸ for developers who care about their blog data.  
> æ§åˆ¶å°å‰ç«¯ä¸ API å‡ä¸ºçº¯é™æ€/æ— çŠ¶æ€è®¾è®¡ï¼Œå¯å®‰å…¨éƒ¨ç½²äºè¾¹ç¼˜ç½‘ç»œã€‚